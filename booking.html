<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-i18n="site.title">Запись на приём</title>
  <link rel="stylesheet" href="assets/styles.css">
  <script src="assets/config.js"></script>
  <script src="assets/i18n.js"></script>
  <script src="assets/calendar.js"></script>
  <script src="assets/app.js"></script>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
</head>
<body>
  <div class="container">
    <header>
      <nav>
        <a href="index.html" data-i18n="nav.home"></a>
        <a href="about.html" data-i18n="nav.about"></a>
        <a href="rules.html" data-i18n="nav.rules"></a>
        <a href="booking.html" class="is-active" data-i18n="nav.booking"></a>
      </nav>
      <div class="lang-switch" style="margin-left:auto">
        <button data-lang="ru">RU</button>
        <button data-lang="lv">LV</button>
        <button data-lang="en">EN</button>
      </div>
    </header>

    <section class="card">
      <h1 data-i18n="site.title">Запись на приём</h1>
      <p class="muted" data-i18n="booking.hint">
        1) Выберите дату и время. 2) Заполните контактные данные. 3) Нажмите «Забронировать».
      </p>
    </section>

    <!-- Календарь + форма, 50/50 -->
    <section class="card grid grid-2">
      <!-- Левая колонка: Ближайшая запись → Слоты → Календарь -->
      <section>
        <!-- Ближайшая запись (строка фиксированной высоты, без шевеления макета) -->
        <div id="next-slot" class="next-slot-row">
          <div class="next-slot__text">
            <span data-i18n="nextslot.title">Ближайшая запись</span>:
            <strong id="next-slot-date"></strong><span id="next-slot-comma" class="comma">,</span>
            <strong id="next-slot-time"></strong>
          </div>
          <button id="next-slot-jump" class="btn btn-outline btn-small" type="button" data-i18n="nextslot.cta">
            Перейти
          </button>
        </div>

        <!-- Слоты выбранного дня -->
        <h3 class="h3" data-i18n="booking.available">Доступные слоты —</h3>
        <div id="day-slots" class="slot-chips"></div>

        <!-- Календарь -->
        <div id="calendar">
          <div class="controls">
            <button id="prev" class="iconbtn" aria-label="Предыдущий месяц">←</button>
            <button id="next" class="iconbtn" aria-label="Следующий месяц">→</button>
            <div id="month-label" class="month-label"></div>
          </div>

          <table class="cal">
            <thead>
              <tr>
                <th>Пн</th><th>Вт</th><th>Ср</th><th>Чт</th><th>Пт</th><th>Сб</th><th>Вс</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <p class="muted" data-i18n-md="booking.legend_md">
            • Точка под датой — есть свободное время. Нажмите дату, затем выберите время.
            После бронирования запись появится в вашем календаре.
          </p>
        </div>
      </section>

      <!-- Правая колонка: форма записи -->
      <aside>
        <form id="booking-form" onsubmit="submitBooking(event)" novalidate>
          <!-- honeypot -->
          <input type="text" name="website" style="position:absolute;left:-5000px;top:auto;width:1px;height:1px;opacity:0" tabindex="-1" autocomplete="off">

          <div class="row2">
            <label><span data-i18n="form.name">Имя и фамилия</span><br>
              <input class="input" type="text" name="name" required>
            </label>
            <label><span data-i18n="form.email">E-mail</span><br>
              <input class="input" type="email" name="email" required>
            </label>
          </div>

          <div class="row2" style="margin-top:12px">
            <label><span data-i18n="form.phone">Телефон</span><br>
              <input class="input" type="tel" name="phone" placeholder="+371 ..." pattern="^\+?[0-9\s\-()]{7,20}$">
            </label>
            <label><span data-i18n="form.mode">Формат визита</span><br>
              <select class="input" name="mode">
                <option value="in_person" data-i18n="form.mode.inperson">Очный визит</option>
                <option value="online" data-i18n="form.mode.online">Онлайн (Google Meet)</option>
              </select>
            </label>
          </div>

          <div class="row2" style="margin-top:12px">
            <label>Дата<br><input class="input" name="date" readonly required></label>
            <label>Время<br><input class="input" name="time" readonly required></label>
          </div>

          <div style="margin-top:12px">
            <label><span data-i18n="form.notes">Комментарий</span><br>
              <textarea class="input" name="notes" maxlength="600" placeholder="Коротко о запросе (до 600 символов)"></textarea>
            </label>
          </div>

          <button class="btn btn-primary" type="submit" style="margin-top:16px" data-i18n="form.submit">Забронировать</button>
          <div id="booking-out"></div>
        </form>
      </aside>
    </section>

    <footer>© <span id="year"></span></footer>
  </div>
</body>
</html>
